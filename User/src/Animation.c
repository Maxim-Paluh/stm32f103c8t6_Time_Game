#include "Animation.h"
#include "rcc.h"
#include "led.h"

const uint8_t anim1[][4] = {
    {0xFE, 0xFE, 0xFE, 0xFE},
    {0xFD, 0xFD, 0xFD, 0xFD},
    {0xFB, 0xFB, 0xFB, 0xFB},
    {0xF7, 0xF7, 0xF7, 0xF7},
    {0xEF, 0xEF, 0xEF, 0xEF},
    {0xDF, 0xDF, 0xDF, 0xDF}
};

const uint8_t anim2[][4] = {
    {0xFE, 0xFF, 0xFE, 0xFF},
    {0xFF, 0xFE, 0xFF, 0xFE},
    {0xFF, 0xFD, 0xFF, 0xFD},
    {0xFF, 0xFB, 0xFF, 0xFB},
    {0xFF, 0xF7, 0xFF, 0xF7},
    {0xF7, 0xFF, 0xF7, 0xFF},
    {0xEF, 0xFF, 0xEF, 0xFF},
    {0xDF, 0xFF, 0xDF, 0xFF}
};

const uint8_t anim3[][4] = {
    {0xFE, 0xFF, 0xFF, 0xFF},
    {0xFF, 0xFE, 0xFF, 0xFF},
    {0xFF, 0xFF, 0xFE, 0xFF},
    {0xFF, 0xFF, 0xFF, 0xFE},
    
    {0xFF, 0xFF, 0xFF, 0xFD},
    {0xFF, 0xFF, 0xFF, 0xFB},
    {0xFF, 0xFF, 0xFF, 0xF7},
    {0xFF, 0xFF, 0xF7, 0xFF},
    
    {0xFF, 0xF7, 0xFF, 0xFF},
    {0xF7, 0xFF, 0xFF, 0xFF},
    {0xEF, 0xFF, 0xFF, 0xFF},
    {0xDF, 0xFF, 0xFF, 0xFF}
};

void Animate(Animation* anim)
{
    if (!anim->active) return;

    if (Millis - anim->lastMillis >= anim->delay)
    {
        anim->lastMillis = Millis;

        const uint8_t* f = anim->frames[anim->currentIndex];
        ledprintt(f[0], f[1], f[2], f[3]);

        anim->currentIndex++;

        if (anim->currentIndex >= anim->frameCount)
        {
          anim->currentIndex = 0;
          anim->currentRepet++;
          if(anim->currentRepet < anim->countRepet)
          {
            anim->delay += anim->speedStep; // нарощуємо/зменшуємо паузу
          }
          else 
          {
            if(anim->endPausa)
            {
              anim->currentIndex = anim->frameCount - 1;
              anim->endPausa = false;
            }
            else
            {
              anim->active = false;
              anim->endPausa = true;
              anim->currentRepet = 0;
              return;
            }
          }
        }
    }
}